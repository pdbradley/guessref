#!/bin/bash
set -e

if [ -f /myapp/tmp/pids/server.pid ]; then
  rm /myapp/tmp/pids/server.pid
fi

# https://stackoverflow.com/questions/38089999/docker-compose-rails-best-practice-to-migrate
# probably should get rake db:setup working...

rake db:create
rake db:migrate

sleep 10
cd hasura
hasura metadata apply --endpoint http://hasura:8080 --admin-secret secret
cd ..

exec "$@"
